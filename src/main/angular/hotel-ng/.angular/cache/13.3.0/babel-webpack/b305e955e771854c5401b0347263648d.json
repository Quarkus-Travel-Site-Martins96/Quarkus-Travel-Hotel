{"ast":null,"code":"import { HttpHeaders } from '@angular/common/http';\nimport { Environment } from 'src/environments/environment';\nimport { JWT } from './jwt-decode-vo';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../cookie-utils\";\nimport * as i2 from \"../rest-service\";\nimport * as i3 from \"@angular/common\";\n\nfunction ToolbarComponent_div_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 6)(1, \"a\", 3)(2, \"span\");\n    i0.ɵɵtext(3, \"LOGIN\");\n    i0.ɵɵelementEnd()()();\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"href\", ctx_r0.loginUrl, i0.ɵɵsanitizeUrl);\n  }\n}\n\nfunction ToolbarComponent_div_8_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r3 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 7)(1, \"div\", 8)(2, \"a\", 3);\n    i0.ɵɵtext(3, \"Edit user\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"a\", 9);\n    i0.ɵɵlistener(\"click\", function ToolbarComponent_div_8_Template_a_click_4_listener() {\n      i0.ɵɵrestoreView(_r3);\n      const ctx_r2 = i0.ɵɵnextContext();\n      return ctx_r2.logout();\n    });\n    i0.ɵɵtext(5, \"Logout\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelement(6, \"img\", 10);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"href\", ctx_r1.userManagementUrl, i0.ɵɵsanitizeUrl);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"href\", ctx_r1.homeUrl, i0.ɵɵsanitizeUrl);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"src\", ctx_r1.jwt.avatar, i0.ɵɵsanitizeUrl)(\"alt\", ctx_r1.jwt.name);\n  }\n}\n\nexport let ToolbarComponent = /*#__PURE__*/(() => {\n  class ToolbarComponent {\n    constructor(cookieMng, rest) {\n      this.cookieMng = cookieMng;\n      this.rest = rest;\n      this.validateUrl = Environment.getLoginHost() + \"/validate\";\n      this.homeUrl = Environment.getHomeHost();\n      this.loginUrl = Environment.getLoginHost();\n      this.userManagementUrl = Environment.getUserManagerHost();\n      this.jwt = new JWT();\n      this.cookieJWT = this.cookieMng.getCookie('user.jwt');\n    }\n\n    ngOnInit() {\n      if (this.sub) this.sub.unsubscribe();\n\n      if (this.cookieJWT) {\n        //JWT found, check if is valid\n        this.sub = this.rest.sendPost(this.validateUrl, this.cookieJWT, new HttpHeaders({\n          'content-type': 'text/plain'\n        })).subscribe(resp => {\n          //JWT correct, move to Home Page\n          this.jwt = resp.body;\n        }, error => {\n          //JWT non correct or service not available\n          if (error.status === 401) {\n            console.error('The token JWT is not valid, relogin required', error);\n            this.logout();\n          } else {\n            console.error('The call is not end correct', error);\n            this.jwt = null;\n          }\n        });\n      }\n    }\n\n    ngAfterViewInit() {\n      let prevScrollpos = window.pageYOffset;\n\n      window.onscroll = function () {\n        var currentScrollPos = window.pageYOffset;\n\n        if (prevScrollpos > currentScrollPos) {\n          document.getElementById(\"navbar\").style.top = \"0\";\n        } else {\n          document.getElementById(\"navbar\").style.top = \"-80px\";\n        }\n\n        prevScrollpos = currentScrollPos;\n      };\n    }\n\n    logout() {\n      this.cookieMng.deleteCookie('user.jwt');\n      window.top.location.href = this.homeUrl;\n    }\n\n  }\n\n  ToolbarComponent.ɵfac = function ToolbarComponent_Factory(t) {\n    return new (t || ToolbarComponent)(i0.ɵɵdirectiveInject(i1.CookieManager), i0.ɵɵdirectiveInject(i2.RestService));\n  };\n\n  ToolbarComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: ToolbarComponent,\n    selectors: [[\"app-toolbar\"]],\n    decls: 9,\n    vars: 3,\n    consts: [[\"id\", \"navbar\", 1, \"u-clearfix\", \"header\"], [1, \"container\"], [1, \"logo\"], [3, \"href\"], [\"class\", \"login\", 4, \"ngIf\"], [\"class\", \"logged\", 4, \"ngIf\"], [1, \"login\"], [1, \"logged\"], [1, \"user-mngmnt\"], [3, \"href\", \"click\"], [3, \"src\", \"alt\"]],\n    template: function ToolbarComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"header\", 0)(1, \"div\", 1)(2, \"nav\")(3, \"div\", 2)(4, \"a\", 3)(5, \"span\");\n        i0.ɵɵtext(6, \"LOGO\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵtemplate(7, ToolbarComponent_div_7_Template, 4, 1, \"div\", 4);\n        i0.ɵɵtemplate(8, ToolbarComponent_div_8_Template, 7, 4, \"div\", 5);\n        i0.ɵɵelementEnd()()();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"href\", ctx.homeUrl, i0.ɵɵsanitizeUrl);\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"ngIf\", !ctx.cookieJWT);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.cookieJWT);\n      }\n    },\n    directives: [i3.NgIf],\n    styles: [\"nav[_ngcontent-%COMP%]{display:flex;flex-wrap:nowrap;justify-content:flex-start;font-size:1.5em;text-shadow:0 0 2px black}nav[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{margin:5px 10px;align-self:center}nav[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:last-child{margin-left:auto}.u-clearfix[_ngcontent-%COMP%]:after, .u-clearfix[_ngcontent-%COMP%]:before{content:\\\"\\\";display:table}.u-clearfix[_ngcontent-%COMP%]:after{clear:both}header[_ngcontent-%COMP%]{background-color:#00000080;z-index:100;position:fixed;width:100%;top:0;transition:top .3s}img[_ngcontent-%COMP%]{height:auto;max-height:50px;border-radius:40px;box-shadow:0 0 5px #ffffffbf}a[_ngcontent-%COMP%]{text-decoration:none;color:#fffc}.user-mngmnt[_ngcontent-%COMP%]{padding:10px 20px;background-color:#c8c8c8cc;border:1px solid #fff;border-radius:10px;position:absolute;right:10px;top:50px;opacity:0;transition:linear .5s;display:block;font-feature-settings:\\\"smcp\\\";font-variant:small-caps}.user-mngmnt[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{margin:5px 0;color:#000;font-size:.6em;float:left;clear:left}.logged[_ngcontent-%COMP%]:hover   .user-mngmnt[_ngcontent-%COMP%], .logged[_ngcontent-%COMP%]:active   .user-mngmnt[_ngcontent-%COMP%], .logged[_ngcontent-%COMP%]:focus   .user-mngmnt[_ngcontent-%COMP%]{opacity:1;top:70px}\"]\n  });\n  return ToolbarComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}